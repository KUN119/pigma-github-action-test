name: Sync Design Tokens

# ì–¸ì œ ì‹¤í–‰ë ì§€ ì •ì˜
on:
  push:
    # 'chore/setup-design-tokens' ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œë§Œ (ë¸Œëœì¹˜ëª…ì´ developì´ë©´ ë³€ê²½ í•„ìš”)
    branches:
      - chore/setup-design-tokens
    # ì¤‘ìš”: 'tokens' í´ë” ë‚´ì˜ json íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ ì‹¤í–‰ (ë¶ˆí•„ìš”í•œ ì‹¤í–‰ ë°©ì§€)
    paths:
      - 'tokens/**.json'

permissions:
  contents: write # ì‹¤í–‰í•  ì‘ì—… ê¶Œí•œ ì„¤ì • (ì»¤ë°‹ì„ ìœ„í•´ ì“°ê¸° ê¶Œí•œ í•„ìš”)
  actions: read
  checks: read
  statuses: read

jobs:
  build_and_commit:
    runs-on: ubuntu-latest
    steps:
      # 1. ì½”ë“œ ë‚´ë ¤ë°›ê¸°
      - name: Checkout Code
        uses: actions/checkout@v4

      # 2. Node.js í™˜ê²½ ì„¤ì •
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # í˜„ì¬ LTS ë²„ì „ ê¶Œì¥

      # 3. ì˜ì¡´ì„± ì„¤ì¹˜ (npm ciëŠ” CI í™˜ê²½ì—ì„œ ë” ë¹ ë¥´ê³  ì•ˆì •ì ì…ë‹ˆë‹¤)
      - name: Install Dependencies
        run: npm ci

      # 4. ì•„ê¹Œ ë§Œë“  ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (JSON -> CSS ë³€í™˜)
      - name: Build Design Tokens
        run: npm run build:tokens

      # 5. ë³€ê²½ëœ CSS íŒŒì¼ ê°ì§€ ë° ìë™ ì»¤ë°‹
      - name: Commit Changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'ğŸ¨ Design System Update: Auto-generated CSS'
          # ì¤‘ìš”: ë³€í™˜ëœ ê²°ê³¼ë¬¼ íŒŒì¼ ê²½ë¡œ (ì•„ê¹Œ build.jsì—ì„œ ì„¤ì •í•œ ê²½ë¡œ)
          file_pattern: 'src/styles/variables.css'

      # ê¹ƒí—ˆë¸Œ ì•¡ì…˜ ë°œìƒí•  ê²½ìš° slackì— ì•Œë¦¼ì˜¤ë„ë¡ ì—°ë™
      - name: Slack Notification
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          author_name: 'ë°°í¬ ë‹´ë‹¹ì: ${{ github.actor }}'
          fields: repo,message,commit,author,action,eventName,ref,workflow,job,took
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        if: always()
